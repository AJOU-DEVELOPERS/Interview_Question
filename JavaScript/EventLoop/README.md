> # 이벤트 루프

자바스크립트는 싱글 스레드로 동작한다.
브라우저는 멀티 스레드로 동작한다.

자바스크립트의 싱글 스레드 방식은 한 번에 하나의 태스크만 처리 한다.

### 브라우저는 많은 태스크가 동시에 처리되는 것처럼 느껴진다.

예를들어, HTML 요소가 애니메이션 효과를 통해 움직이면서 이벤트를 처리하기도한다.
이것은 **이벤트 루프**가 자바스크립트의 동시성을 지원하기때문이다.

이벤트 루프는 브라우저에 내장되어 있는 기능 중 하나이다.

비동기 방식으로 동작하는 setTimeout의 콜백 함수의 평가와 실행은 자바스크립트 엔진이 담당하지만, 호출 스케줄링을 위한 타이머 설정과 콜백 함수의 등록은 브라우저 또는 Node.js가 담당한다.


## 이벤트 루프

콜 스택에 현재 실행중인 실행 컨텍스트가 있는지, 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인한다.

콜 스택이 비어있고 태스크 큐에 대기 중인 함수가 있다면 이벤트 루프는 순차적으로 태스크 큐에 대기 중인 함수를 콜 스택으로 이동시킨다.

이때, 콜 스택으로 이동한 함수는 실행된다.

ex) setTimeout이 실행되면 콜스택에 push된다. setTimeout에 설정한 타이머가 만료되면 callback 함수를 브라우저가 태스크 큐로 이동시키고, setTimeout은 콜스택에서 pop 된다.

=> setTimeout에 설정한 타이머는 브라우저가 설정하며, 이후 코드를 읽어 콜 스택에 들어올 함수가 있다면 콜스택에 넣어서 진행하는데, 이 과정은 동시에 병행 처리된다.

## 태스크 큐

비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역이다.
브라우저가 태스크 큐에 push를한다.
브라우저의 이벤트 루프가 콜 스택을 확인하고 태스크 큐에 접근하여 콜백 함수를 콜 스택에 push한다.

## 마이크로 큐

프로미스의 후속 처리 메서드의 콜백 함수가 일시적으로 보관되는 영역이다.

```jsx
setTimeout(() => console.log(1),0);

Promise.resolve()
.then(() => console.log(2))
.then(() => console.log(3));
```
위 코드는 2 , 3 , 1 이라는 결과를 발생한다.
비동기 함수의 콜백함수는 태스크 큐에 들어간다고 생각을해서 1 => 2 => 3을 출력할거라 생각하지만,
프로미스의 후속 처리 메서드의 콜백 함수는 마이크로태스크 큐에 저장이된다.

마이크로 태스크 큐는 태스크 큐와는 별도의 큐이다.

마이크로 태스크 큐에는 프로미스의 후속 처리 메서드의 콜백 함수가 일시 저장된다.

마이크로 태스크 큐는 태스크 큐보다 우선순위가 높다.

즉, 콜 스택이 비면 먼저 마이크로 태스크 큐에서 대기하고 있는 함수를 가져와 실행하고 마이크로 태스크 큐가 비면 태스크 큐에서 대기하고 있는 함수를 가져와 실행한다.

## 브라우저

브라우저는 자바스크립트 엔진 외에도 렌더링 엔진과 Web API를 제공한다.
Web API는 ECMAScript 사양에 정의된 함수가 아니라 브라우저에서 제공하는 API이다.
DOM API와 타이머 함수 , HTTP 요청과 같은 비동기 처리를 포함한다.

